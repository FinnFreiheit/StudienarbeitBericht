%!TEX root = ../../main.tex
\chapter{Datenbanken}\label{mongo}

Um Daten zu speichern, gibt es verschiedene Lösungsansätze. Generell unterscheidet man zwischen den SQL- und NoSQL-Datenbankansätzen. Die Abkürzung \glqq SQL\grqq{} steht dabei für die \glqq Sequel Query Language\grqq{}, die zur Abfrage von relationalen Datenbanken genutzt wird. Im Gegensatz dazu umfasst der Begriff \glqq NoSQL\grqq{} – ausgeschrieben \glqq Not only SQL\grqq{} – jene Datenbanksysteme, die nicht den relationalen Ansätzen entsprechen.

\section{SQL}
Spricht man von SQL-Datenbankansätzen, ist die Rede von Relationalen-Datenbank-Management-Systemen (RDBMS). Innerhalb eines RDBMS werden die Daten strukturiert in Tabellen gespeichert, wobei jede Spalte über einen spezifischen Typ verfügt. Systeme relationaler Datenbanken basieren auf dem Konzept sogenannter ACID-Transaktionen.

\subsection{ACID}

ACID ist die Abkürzung vierer Worte, die den Aufbau und die Funktionsweise der RDBMS beschreiben: atomar, konsistent, isoliert und dauerhaft (eng.: Atomic, Consistent, Isolated, Durable). 
Unter atomar versteht man die Aussage, dass entweder alle Änderungen, die während einer Transaktion vorgenommen werden, übernommen werden oder keine dieser Änderungen. Nachdem die Transaktion durchgeführt wurde, befinden sich die Daten in einem konsistenten Zustand. Damit erhalten alle Abfragen, die bestimmte Daten abrufen möchten, dasselbe aktualisierte Ergebnis. Die Transaktionen, die an einem Datensatz vorgenommen werden, sind außerdem isoliert und damit unabhängig von weiteren Transaktionen. Zuletzt sind Änderungen, die innerhalb des Systems passieren, permanent und gehen im Falle eines Versagens desjenigen Systems nicht verloren.


\section{NoSQL}

NoSQL-Datenbankansätze basieren nicht auf dem Konzept der ACID-Transaktionen. Ihre Charakteristik liegt in der Speicherung von semi- bis hin zu unstrukturierten Daten. Dadurch verfügen sie über ein flexibles Datenmodell und werden gerne für große Datenmengen im Internet verwendet. Anstelle des ACID-Konzepts liegt die Grundlage der nichtrelationalen Datenbanksysteme in dem BASE-Konzept. Um dieses jedoch verstehen zu können, muss zuerst ein Überblick über das CAP-Theorem verschafft werden.
Das Kürzel \texttt{CAP} steht für die Bedingungen Konsistenz, Verfügbarkeit und Teilungstoleranz (eng: Consistency, Availability, Partion Tolerance). Die Konsistenz bedeutet auch hier den einheitlichen Zustand der Daten nach Durchführung einer Transaktion. Unter der Verfügbarkeit versteht man die durchgängige Erreichbarkeit des Systems. Die Teilungstoleranz sagt aus, dass das System auch weiterfunktionieren kann, sollte es auf Gruppen von Servern aufgeteilt werden, die nicht in der Lage sind, miteinander zu kommunizieren. 
Laut dem Theorem können jedoch immer nur zwei der drei Bedingungen gleichzeitig erfüllt werden. Auf dieser Theorie basiert BASE. Darunter versteht man die grundsätzliche Verfügbarkeit, den weichen Zustand und die letztendliche Konsistenz (eng: Basically Available, Soft state, Eventual consistency). 
Auf Grundlage des BASE-Konzepts ist das System im Sinne des CAP-Theorems verfügbar. Außerdem verändert sich der Zustand des Systems mit der Zeit, auch wenn dieses keine Eingaben erhält. Dies steht jedoch nicht im Gegensatz zur letztlichen Konsistenz. Auf lange Sicht wird das System einen konsistenten Zustand erreichen, vorausgesetzt, in dieser Zeit werden keine Daten an das System gesendet.

\section{SQL vs NoSQL}

Einen großen Unterschied der beiden Ansätze sieht man in der Flexibilität der Schemata. RDBMS weisen nur eine geringe Flexibilität in ihrem Design auf. Sie sind zeilenorientiert, sodass schon das Hinzufügen einer Spalte zu einer Tabelle zu Problemen führen kann, vor allem, wenn die Tabelle bereits mit Daten gefüllt sein sollte. Oft kann ein solches Hinzufügen dazu führen, dass neue Tabellen erstellt werden. Die Komplexität des Systems wird dadurch erhöht, da es Beziehungen zwischen den Tabellen geben kann.
Spaltenorientierte Datenbanken haben den Vorteil, dass es möglich ist – falls nötig – Spalten ohne Probleme hinzuzufügen. Auch Dokumente mit semistrukturierten Daten schaffen keine größeren Komplexitäten und sind in der Wahl des Schemas sehr flexibel. (S.19) Dadurch ist die Arbeit mit allen möglichen Datentypen möglich. Änderungen, die eine Aktualisierung des Datenbankschemas bedeuten, können somit ohne weiter Probleme umgesetzt werden. (S.18)
Einen weiteren Vergleichspunkt findet man in der Verwendung komplexer Abfragen. Durch den standardisierten Aufbau von RDBMS entstehen komplexe JOIN-Abfragen, die sowohl schwer zu implementieren und zu pflegen sind als auch erhebliche Ressourcen für die Ausführung benötigen. NoSQL-Datenbanken verfügen weder über Beziehungen noch Fremdschlüssel, wodurch keine komplexen Abfragen entstehen. Jedoch müssen mehrere Abfragen ausgeführt werden, um über eine Tabelle hinaus abfragen zu können. (S.19/20) Die einfachen Datenmodelle führen dennoch zu einer einfachen Verwaltbarkeit. (S.18) 
Ebenfalls wichtig zu betrachten ist die Skalierbarkeit. Hierbei gilt es, die beiden Ansätze von Scale-up und Scale-out zu erläutern. SQL-Datenbanken nutzen den Scale-up-Ansatz. Dabei erfolgt die Erweiterung vertikal mithilfe von kostspieligen, qualitätsvollen Servern. Dieser Ansatz versagt jedoch, sobald die Transaktionsraten und Anforderungen an schnelle Reaktionen steigen. In Momenten wie diesen kommt der Scale-out-Ansatz zum Einsatz. Dabei findet eine horizontale Erweiterung unter Verwendung von günstigen Commodity-Servern statt. (S.18) Diesen Ansatz nutzen NoSQL-Datenbanken, wodurch sie eine bessere Skalierbarkeit bieten, als auch Daten preiswert speichern und verarbeiten können. (S.19/20)
Ein letzter wichtiger Vergleichspunkt ist die Synchronisation der Daten. Das Aktualisieren der Daten über die Tabellen der RDBMS hinweg erweist sich als sehr komplex. Die Updates müssen dabei auf die verschiedenen Knoten des Systems verteilt werden. Unterstützen Systeme ein gleichzeitiges Schreiben auf verschiedenen Knoten nicht, kann es dabei zu Fehlern und zu höheren Latenzzeiten kommen. 
Um diese Latenzzeiten gering zu halten, bieten dahingegen NoSQL-Anwendungen gute Synchronisierungsmöglichkeiten. Beispielsweise MongoDB kann eine Aktualisierung gleichzeitig auf mehreren Knoten ausführen und die Konsistenz innerhalb des Systems in einer akzeptablen Latenzzeit sicherstellen. (S.19/20)
Für die Arbeit wird mit der Verwendung der Datenbank MongoDB ein NoSQL-Ansatz gewählt, da die Vorteile vor allem in Bezug auf die Flexibilität der Schemata überwiegen. Ebenso andere Begründungen zur Nutzung von NoSQL-Ansätzen, die in diesem Kapitel beschrieben werden, sind für die Arbeit von Vorteil.

\chapter{MongoDB}

\section{Überblick}
MongoDB ist eine NoSQL-Datenbank, die über einen JSON-basierten Dokumentenspeicher verfügt. Abfragen in MongoDB basieren auf den Schlüsseln innerhalb der Dokumente. Jene Dokumente können auf verschiedenen Servern verteilt sein. Führt man eine Abfrage aus, sucht in seinen Dokumenten nach Resultaten, die er als Ergebnis ausgibt. Dadurch erreicht man eine lineare Skalierbarkeit und eine verbesserte Performance. 
Außerdem verfügt MongoDB über eine Primär-Sekundär-Replikation, wobei die Primärseite die Schreibanforderungen annimmt. Will man die Schreibleistung verbessern, kann man das sogenannte Sharding einsetzen. Dabei werden die Daten auf mehrere Rechner verteilt, die jeweils unterschiedliche Teile der Datensätze aktualisieren können. In MongoDB wird Sharding automatisch ausgeführt. Fügt man einen neuen Rechner hinzu, werden die Daten automatisch verteilt. (S.26)

\section{Speicherung der Daten}
\subsection{JSON-basierte Speicherung}
Eine Datenbank enthält Kollektionen, die Dokumente umfassen. Diese Dokumente enthalten die zu speichernden Daten (S.30) in Form von Schlüssel-Wert-Paaren (S.27). Zur Speicherung wird Binary JSON – kurz BSON – eingesetzt. JSON ist die JavaScript Object Notation und gilt als einer der Standardsprachen für den Datenaustausch im heutigen, modernen Web. Das Format von JSON ist sowohl für Maschinen als auch für den Menschen lesbar. Zudem werden alle Standarddatentypen wie beispielsweise Strings, Zahlenwerte, Boolean-Werte und Arrays unterstützt und können verwendet werden. (S.31)
Ein Vorteil von JSON ist die Möglichkeit, zusammengehörige Daten gruppiert an einem Platz zu speichern. Dadurch sind gewisse Daten einfacher auffindbar, was die Performance der Abfragen verbessert. Außerdem ist es möglich, schemalose Modelle zu verwenden, wodurch Änderungen an einem Schema nie zu Problemen führen können.
Im Gegenteil zu RDBMS kann für eine Speicherung ein dynamisches Schema gewählt werden. Dies bedeutet, dass Dokumente über unterschiedliche Strukturen oder Felder verfügen oder aber auch ähnliche Felder unterschiedliche Daten speichern können. (S.26/27) In Fällen, in denen eine Kollektion Dokumente unterschiedlicher Typen beinhaltet, spricht man von einem polymorphen Schema. (S.32)

\subsection{BSON}
Ein JSON-Dokument enthält die tatsächlichen Daten. Dennoch werden jene Daten nicht in dieser Form abgespeichert, sondern zuvor binär verschlüsselt. Die Implementierung eines BSON-Dokuments in MongoDB ist schnell und leichtgewichtig. Außerdem ermöglicht es MongoDB, Indizes in Objekten zu erstellen und diese mit den Abfragen abzugleichen. (S.31)


\subsection{Identifier}

Wie auch die Primärschlüssel in RDBMS werden Identifier in Dokumenten benötigt, um diese identifizieren zu können. Identifier werden mit dem Schlüssel \texttt{id} bezeichnet. Den Wert der ID kann man – sofern es gewollt ist – selbst zuordnen. Dafür kann jeder beliebige Datentyp verwendet werden, außer Arrays. Ordnet man selbst der ID keinen Wert zu, übernimmt dies MongoDB automatisch.